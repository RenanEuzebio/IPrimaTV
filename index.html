<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>WebTorrent Minimal Player</title>
<script src="https://cdn.jsdelivr.net/npm/webtorrent@latest/webtorrent.min.js"></script>
<style>
  body { font-family: system-ui, sans-serif; margin: 1rem; }
  video { width: 100%; max-width: 640px; background:#000; }
</style>
</head>
<body>
<video id="video" controls autoplay playsinline></video>

<script>
/*
  Trimmed magnet: only WSS trackers that commonly work in browsers.
  (You can add more wss:// trackers if needed.)
*/
const magnet = 'magnet:?xt=urn:btih:08ada5a7a6183aae1e09d831df6748d566095a10'
  + '&dn=Sintel'
  + '&tr=wss://tracker.openwebtorrent.com'
  + '&tr=wss://tracker.webtorrent.dev';

/*
  Custom rtcConfig: remove Twilio entry that caused your RTCPeerConnection error.
  (Add more STUN servers if you like.)
*/
const client = new WebTorrent({
  tracker: {
    rtcConfig: {
      iceServers: [
        { urls: 'stun:stun.l.google.com:19302' },
        { urls: 'stun:stun1.l.google.com:19302' }
      ]
    }
  }
});

const videoEl = document.getElementById('video');

client.add(magnet, torrent => {
  const file = torrent.files.find(f => f.name.endsWith('.mp4')) || torrent.files[0];
  if (!file) return console.error('No playable file found in torrent.');

  // Stream directly into existing <video>
  file.renderTo(videoEl, { autoplay: true }, err => {
    if (err) return console.error(err);
    console.log('Streaming started.');
  });
});

client.on('error', err => console.error('WebTorrent error:', err));
</script>
</body>
</html>
